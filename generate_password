import random
import datetime
import tkinter as tk
from tkinter import messagebox

def generate_password(entry_length, entry_title, output_var):

    letters_small = "abcdefghijklmnopqrstuvwxyz"
    letters_big = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    numbers = "0123456789"
    special_chars = "!@#$%^&*()_+{}[]|:;<>,.?/~`"

    try:
        user_input = int(entry_length.get())
    except ValueError:
        messagebox.showerror("Hata", "Lütfen geçerli bir sayı girin!")
        return
    
    if user_input < 8:
        output_var.set("\nPassword length must be at least 8 characters!\n")
        return

    title = entry_title.get()
    if(not title):
        output_var.set("Please enter a title.")
        return
    
    password = []
    for _ in range(user_input):    

        i = random.randint(0, 3)
        match i:
            case 0:
                password.append(random.choice(letters_small))
            case 1:
                password.append(random.choice(letters_big))
            case 2: 
                password.append(random.choice(numbers))
            case 3: 
                password.append(random.choice(special_chars))

    current_datetime = datetime.datetime.now()
    formatted_time = current_datetime.strftime("date: %Y-%m-%d\ntime: %H:%M")

    generate_password = ''.join(password)
    output_var.set(f"Password created for {title}\npassword: {generate_password}\n{formatted_time}")

    with open("randPwd.txt", "a") as file:
        file.write(f"FOR: {title}\npassword: {generate_password}\n{formatted_time}\n\n")

    output_var.set("Password created successfully!")

def reset_fields(entry_length, entry_title, output_var): 
    entry_length.delete(0, tk.END)
    entry_title.delete(0,tk.END)
    output_var.set("")

